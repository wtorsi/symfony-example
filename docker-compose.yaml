version: '3.7'
services:
    #    app:
    #        build: .
    #        container_name: app
    #        working_dir: /usr
    #        restart: on-failure
    #        depends_on:
    #            - php
    #            - mysql
    #            - nginx
    #            - rabbitmq
    #            - redis
    #        networks:
    #            - frontend
    #            - db

    #    supervisor:
    #        build: .
    #        container_name: supervisor
    #        working_dir: /usr
    #        restart: on-failure

    nginx:
        build: .docker/nginx
        container_name: nginx
        working_dir: /usr
        restart: on-failure
        depends_on:
            - php
    #        networks:
    #            - frontend

    mysql:
        build: .docker/mysql
        container_name: mysql
        working_dir: /usr
        restart: on-failure
        command: ["--default-authentication-plugin=mysql_native_password"]
        ports:
            - "3306:3306"
        volumes:
            - /usr/lib/mysql:/var/lib/mysql
        environment:
            - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
            - MYSQL_DATABASE=${MYSQL_DATABASE}
            - MYSQL_USER=${MYSQL_USER}
            - MYSQL_PASSWORD=${MYSQL_PASSWORD}
    #        networks:
    #            - db

    php-fpm:
        build: .docker/php
        container_name: php
        working_dir: /usr
        depends_on:
            - mysql
    #        networks:
    #            - frontend
    #        user: 1000:1000

    rabbitmq:
        build: .docker/rabbitmq
        container_name: rabbitmq
        environment:
            - RABBITMQ_DEFAULT_USER=${RABBITMQ_USER}
            - RABBITMQ_DEFAULT_PASS=${RABBITMQ_PASSWORD}
#        networks:
#            - amqp
#networks:
#    webnet: